<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Gifts - Открывай кейсы</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%233390ec' d='M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M8,10V12H11C10.33,12.08 9.69,12.23 9.06,12.46C8.67,12.62 8.31,12.84 8,13.13C7.67,12.86 7.31,12.63 6.91,12.47C6.29,12.23 5.65,12.08 5,12H4V10H8M13,10H20V12H18C17.34,12.08 16.7,12.23 16.07,12.46C15.68,12.62 15.32,12.84 15,13.13C14.67,12.86 14.31,12.63 13.91,12.47C13.29,12.23 12.65,12.08 12,12H13V10M6,14H8V17H6V14M16,14H18V17H16V14Z'/></svg>">
    <style>
        :root {
            --primary: #3390ec;
            --primary-dark: #1d6dc2;
            --secondary: #2a2f3b;
            --accent: #ff6b35;
            --light: #f5f5f5;
            --dark: #1a1d24;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark) 0%, #242832 100%);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: rgba(42, 47, 59, 0.95);
            padding: 15px 0;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.4);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .balance {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(51, 144, 236, 0.3);
        }
        
        .user-profile {
            position: relative;
            cursor: pointer;
        }
        
        .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .avatar:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 55px;
            right: 0;
            background: var(--secondary);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            width: 280px;
            padding: 15px;
            z-index: 100;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .dropdown-menu.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .dropdown-item {
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            margin-bottom: 5px;
        }
        
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .main-content {
            padding: 30px 0 60px;
        }
        
        .section-title {
            margin-bottom: 25px;
            font-size: 28px;
            color: white;
            position: relative;
            display: inline-block;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, transparent 100%);
            border-radius: 2px;
        }
        
        .buttons-container {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(51, 144, 236, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.2);
        }
        
        .cases-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .case-card {
            background: linear-gradient(145deg, rgba(42, 47, 59, 0.8) 0%, rgba(32, 36, 46, 0.9) 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }
        
        .case-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
        }
        
        .case-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .case-image {
            height: 180px;
            background: linear-gradient(135deg, var(--dark) 0%, #242832 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .case-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(51, 144, 236, 0.1) 0%, transparent 100%);
        }
        
        .case-preview-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }
        
        .case-info {
            padding: 20px;
        }
        
        .case-name {
            font-size: 20px;
            margin-bottom: 10px;
            color: white;
        }
        
        .case-price {
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .case-items {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .item-preview {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .item-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .inventory-title {
            margin: 40px 0 20px;
            font-size: 24px;
            color: white;
        }
        
        .inventory-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
        }
        
        .inventory-item {
            background: linear-gradient(145deg, rgba(42, 47, 59, 0.8) 0%, rgba(32, 36, 46, 0.9) 100%);
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .inventory-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .item-image {
            width: 70px;
            height: 70px;
            margin: 0 auto 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }
        
        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .item-name {
            font-size: 14px;
            margin-bottom: 8px;
            color: white;
        }
        
        .item-value {
            color: var(--accent);
            font-size: 14px;
            margin-bottom: 12px;
            font-weight: bold;
        }
        
        .sell-btn {
            background: linear-gradient(135deg, var(--accent) 0%, #e55a2b 100%);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .sell-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(255, 107, 53, 0.3);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: linear-gradient(145deg, var(--secondary) 0%, #242832 100%);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 24px;
            cursor: pointer;
        }
        
        .modal-title {
            margin-bottom: 20px;
            font-size: 24px;
            color: white;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
        }
        
        .captcha-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .captcha-code {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 20px;
            border-radius: 8px;
            font-family: monospace;
            letter-spacing: 5px;
            font-size: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 150px;
            text-align: center;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
        }
        
        .case-opening {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            display: none;
        }
        
        .case-opening.active {
            display: flex;
        }
        
        .case-reward {
            text-align: center;
            animation: pulse 1.5s infinite;
            background: linear-gradient(145deg, var(--secondary) 0%, #242832 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-width: 400px;
            width: 90%;
        }
        
        .reward-image {
            width: 150px;
            height: 150px;
            margin: 0 auto 25px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .reward-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .reward-name {
            font-size: 26px;
            margin-bottom: 10px;
            color: white;
        }
        
        .reward-value {
            color: var(--accent);
            font-size: 20px;
            margin-bottom: 25px;
        }
        
        .admin-panel {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            display: none;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-title {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .admin-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .leaders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(42, 47, 59, 0.5);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .leaders-table th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 15px;
            text-align: left;
            color: white;
        }
        
        .leaders-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .leader-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .leader-user {
            display: flex;
            align-items: center;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .tab {
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Стили для рулетки */
        .roulette-modal {
            max-width: 900px;
            width: 95%;
        }

        .roulette-container {
            position: relative;
            margin: 30px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .roulette-wheel {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, 
                #feca57, #ff9ff3, #54a0ff, #5f27cd
            );
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .roulette-item {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: rotate(0deg);
        }

        .roulette-item-content {
            transform: rotate(45deg);
            text-align: center;
            width: 80px;
        }

        .roulette-item-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
            margin-bottom: 5px;
        }

        .roulette-item-name {
            font-size: 10px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .roulette-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid var(--accent);
            z-index: 10;
        }

        .possible-items {
            margin: 20px 0;
        }

        .possible-items h3 {
            margin-bottom: 15px;
            color: white;
            text-align: center;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
        }

        .item-preview-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .item-preview-card:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.15);
        }

        .item-preview-image {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .item-preview-name {
            font-size: 12px;
            color: white;
            margin-bottom: 5px;
        }

        .item-preview-value {
            font-size: 11px;
            color: var(--accent);
            font-weight: bold;
        }

        .roulette-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .roulette-controls .btn {
            min-width: 120px;
        }

        /* Анимации рулетки */
        @keyframes rouletteSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(calc(360deg * 5 + var(--stop-angle))); }
        }

        .roulette-wheel.spinning {
            animation: rouletteSpin 4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* Стили для уведомлений */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .notification-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .buttons-container {
                flex-direction: column;
            }
            
            .cases-container {
                grid-template-columns: 1fr;
            }
            
            .admin-controls {
                flex-direction: column;
            }

            .roulette-wheel {
                width: 300px;
                height: 300px;
            }
            
            .roulette-item-content {
                width: 60px;
            }
            
            .roulette-item-image {
                width: 30px;
                height: 30px;
            }
            
            .items-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .roulette-wheel {
                width: 250px;
                height: 250px;
            }
            
            .roulette-modal {
                padding: 20px;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="#3390ec">
                        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M8,10V12H11C10.33,12.08 9.69,12.23 9.06,12.46C8.67,12.62 8.31,12.84 8,13.13C7.67,12.86 7.31,12.63 6.91,12.47C6.29,12.23 5.65,12.08 5,12H4V10H8M13,10H20V12H18C17.34,12.08 16.7,12.23 16.07,12.46C15.68,12.62 15.32,12.84 15,13.13C14.67,12.86 14.31,12.63 13.91,12.47C13.29,12.23 12.65,12.08 12,12H13V10M6,14H8V17H6V14M16,14H18V17H16V14Z"/>
                    </svg>
                    Telegram Gifts
                </div>
                <div class="balance">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,10.5A1.5,1.5 0 0,1 13.5,12A1.5,1.5 0 0,1 12,13.5A1.5,1.5 0 0,1 10.5,12A1.5,1.5 0 0,1 12,10.5M7.5,10.5A1.5,1.5 0 0,1 9,12A1.5,1.5 0 0,1 7.5,13.5A1.5,1.5 0 0,1 6,12A1.5,1.5 0 0,1 7.5,10.5M16.5,10.5A1.5,1.5 0 0,1 18,12A1.5,1.5 0 0,1 16.5,13.5A1.5,1.5 0 0,1 15,12A1.5,1.5 0 0,1 16.5,10.5Z"/>
                    </svg>
                    <span id="balance">0</span>
                </div>
                <div class="user-profile">
                    <div class="avatar" id="user-avatar">
                        <span>U</span>
                    </div>
                    <div class="dropdown-menu" id="dropdown-menu">
                        <div class="dropdown-item" id="change-avatar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="#3390ec">
                                <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"/>
                            </svg>
                            Сменить аватар
                        </div>
                        <div class="dropdown-item" id="promo-code">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="#3390ec">
                                <path d="M20,6H4V4H20V6M20,18V20H4V18H20M20,12V14H4V12H20M9,10A2,2 0 0,1 11,12A2,2 0 0,1 9,14A2,2 0 0,1 7,12A2,2 0 0,1 9,10M9,16A2,2 0 0,1 11,18A2,2 0 0,1 9,20A2,2 0 0,1 7,18A2,2 0 0,1 9,16M15,11H17V17H15V11M15,7H17V9H15V7Z"/>
                            </svg>
                            Промокод
                        </div>
                        <div class="dropdown-item" id="daily-bonus">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="#3390ec">
                                <path d="M20,2H4V4L9.81,8.36C6.14,9.57 4.14,13.53 5.35,17.2C6.56,20.87 10.5,22.87 14.19,21.66C17.86,20.45 19.86,16.5 18.65,12.82C17.95,10.71 16.3,9.05 14.19,8.36L20,4V2M12,19A5,5 0 0,1 7,14A5,5 0 0,1 12,9A5,5 0 0,1 17,14A5,5 0 0,1 12,19Z"/>
                            </svg>
                            Ежедневный бонус
                        </div>
                        <div class="dropdown-item" id="best-drop">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="#3390ec">
                                <path d="M19,5H17V3H7V5H5A2,2 0 0,0 3,7V8A2,2 0 0,0 5,10V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V10A2,2 0 0,0 21,8V7A2,2 0 0,0 19,5M7,19V10H17V19H7M5,8V7H19V8H5M8,13H16V15H8V13Z"/>
                            </svg>
                            Лучшее падение
                        </div>
                        <div class="dropdown-item" id="statistics">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="#3390ec">
                                <path d="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z"/>
                            </svg>
                            Статистика
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <h1 class="section-title">Кейсы с подарками из Telegram</h1>
            
            <div class="buttons-container">
                <button class="btn btn-primary" id="cases-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                        <path d="M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L5,8.09V15.91L12,19.85L19,15.91V8.09L12,4.15Z"/>
                    </svg>
                    Кейсы
                </button>
                <button class="btn btn-secondary" id="refresh-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                        <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                    </svg>
                    Обновить
                </button>
                <button class="btn btn-secondary" id="leaders-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                        <path d="M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M10,4A4,4 0 0,1 14,8C14,8.91 13.69,9.75 13.18,10.43C12.32,10.75 11.55,11.26 10.91,11.9L10,12A4,4 0 0,1 6,8A4,4 0 0,1 10,4M2,20V18C2,15.88 5.31,14.14 9.5,14C9.18,14.78 9,15.62 9,16.5C9,17.79 9.38,19 10,20H2Z"/>
                    </svg>
                    Лидеры
                </button>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="cases">Кейсы</div>
                <div class="tab" data-tab="leaders">Таблица лидеров</div>
            </div>
            
            <div class="tab-content active" id="cases-tab">
                <div class="admin-panel" id="admin-panel">
                    <h3 class="admin-title">Панель администратора</h3>
                    <div class="admin-controls">
                        <input type="text" class="form-control" id="username-input" placeholder="Имя пользователя">
                        <input type="number" class="form-control" id="balance-input" placeholder="Баланс">
                        <button class="btn btn-primary" id="set-balance-btn">Установить баланс</button>
                    </div>
                </div>
                
                <h2 class="section-title">Бесплатные кейсы</h2>
                <div class="cases-container">
                    <div class="case-card" data-case="daily">
                        <div class="case-image">
                            <img src="/images/cases/daily-case.png" alt="Ежедневный кейс" class="case-preview-image"
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzMzOTBlYyI+PHBhdGggZD0iTTUsNEgxOUEyLDIgMCAwLDEgMjEsNlYxOEEyLDIgMCAwLDEgMTksMjBINUEyLDIgMCAwLDEgMywxOFY2QTIsMiAwIDAsMSA1LDRNNSw4VjEySDExVjhINVpNMTMsOEgxOVYxMkgxM1Y4WiIvPjwvc3ZnPg=='">
                        </div>
                        <div class="case-info">
                            <div class="case-name">Ежедневный кейс</div>
                            <div class="case-price">Бесплатно</div>
                            <div class="case-items">
                                <div class="item-preview">
                                    <img src="/images/items/mighty-arm.png" alt="Mighty Arm">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/desk-calendar.png" alt="Desk Calendar">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/flying-broom.png" alt="Flying Broom">
                                </div>
                            </div>
                            <button class="btn btn-primary open-case-btn" data-case="daily">Открыть</button>
                        </div>
                    </div>
                    
                    <div class="case-card" data-case="bomj">
                        <div class="case-image">
                            <img src="/images/cases/bomj-case.png" alt="Бомжик" class="case-preview-image"
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzMzOTBlYyI+PHBhdGggZD0iTTEyLDNBNCw0IDAgMCwxIDE2LDdBNCw0IDAgMCwxIDEyLDExQTQsNCAwIDAsMSA4LDdBNCw0IDAgMCwxIDEyLDNNMTIsMTNDMTQuNjcsMTMgMjAsMTQuMzMgMjAsMTdWMjBINFYxN0M0LDE0LjMzIDkuMzMsMTMgMTIsMTNaIi8+PC9zdmc+'">
                        </div>
                        <div class="case-info">
                            <div class="case-name">Бомжик</div>
                            <div class="case-price">Бесплатно</div>
                            <div class="case-items">
                                <div class="item-preview">
                                    <img src="/images/items/heart.png" alt="Сердечко">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/bear.png" alt="Мишка">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/rose.png" alt="Роза">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/rocket.png" alt="Ракета">
                                </div>
                            </div>
                            <button class="btn btn-primary open-case-btn" data-case="bomj">Открыть</button>
                        </div>
                    </div>
                </div>
                
                <h2 class="section-title">Платные кейсы</h2>
                <div class="cases-container">
                    <div class="case-card" data-case="durov">
                        <div class="case-image">
                            <img src="/images/cases/durov-case.png" alt="Durov Case" class="case-preview-image"
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzMzOTBlYyI+PHBhdGggZD0iTTE4LjcxLDE5LjVDMTcuODgsMjAuNzQgMTcsMjEuOTUgMTUuNjYsMjEuOTdDMTQuMzIsMjIgMTMuODksMjEuMTggMTIuMzcsMjEuMThDMTAuODQsMjEuMTggMTAuMzcsMjEuOTUgOS4xLDIyQzcuNzksMjIuMDUgNi44LDIwLjY4IDUuOTYsMTkuNDdDNC4yNSwxNyAyLjk0LDEyLjQ1IDQuNyw5LjM5QzUuNTcsNy44NyA3LjEzLDYuOTEgOC44Miw2Ljg4QzEwLjEsNi44NiAxMS4zMiw3Ljc1IDEyLjExLDcuNzVDMTIuODksNy43NSAxNC4zNyw2LjY4IDE1LjkyLDYuODRDMTYuNTcsNi44NyAxOC4zOSw3LjEgMTkuNTYsOC44MkMxOS40Nyw4Ljg4IDE3LjM5LDEwLjEgMTcuNDEsMTIuNjNDMTcuNDQsMTUuNjUgMjAuMDYsMTYuNjYgMjAuMDksMTYuNjdDMjAuMDYsMTYuNzQgMTkuNjcsMTguMTEgMTguNzEsMTkuNU0xMywzLjVDMTMuNzMsMi42NyAxNC45NCwyLjA0IDE1Ljk0LDJDMTYuMDcsMy4xNyAxNS42LDQuMzUgMTQuOSw1LjE5QzE0LjIxLDYuMDQgMTMuMDcsNi43IDExLjk1LDYuNjFDMTEuOCw1LjQ2IDEyLjM2LDQuMjYgMTMsMy41WiIvPjwvc3ZnPg=='">
                        </div>
                        <div class="case-info">
                            <div class="case-name">Durov Case</div>
                            <div class="case-price">100 ★</div>
                            <div class="case-items">
                                <div class="item-preview">
                                    <img src="/images/items/pepe.png" alt="Plush Pepe">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/sigar.png" alt="Vintage Sigar">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/hat.png" alt="Top Hat">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/perfume.png" alt="Perfume Bottle">
                                </div>
                            </div>
                            <button class="btn btn-primary open-case-btn" data-case="durov">Открыть за 100 ★</button>
                        </div>
                    </div>
                    
                    <div class="case-card" data-case="bayrex">
                        <div class="case-image">
                            <img src="/images/cases/bayrex-case.png" alt="BayRex Case" class="case-preview-image"
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzMzOTBlYyI+PHBhdGggZD0iTTE5LDNDMjAuMSwzIDIxLDMuOSAyMSw1VjE5QzIxLDIwLjEgMjAuMSwyMSAxOSwyMUg1QzMuODksMjEgMywyMC4xIDMsMTlWNUMzLDMuOSAzLjksMyA1LDNIMTZNMTIsOEM5Ljc5LDggOCw5Ljc5IDgsMTJDOCwxNC4yMSA5Ljc5LDE2IDEyLDE2QzE0LjIxLDE2IDE2LDE0LjIxIDE2LDEyQzE2LDkuNzkgMTQuMjEsOCAxMiw4WiIvPjwvc3ZnPg=='">
                        </div>
                        <div class="case-info">
                            <div class="case-name">BayRex Case</div>
                            <div class="case-price">150 ★</div>
                            <div class="case-items">
                                <div class="item-preview">
                                    <img src="/images/items/pepe.png" alt="Plush Pepe">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/sigar.png" alt="Vintage Sigar">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/hat.png" alt="Top Hat">
                                </div>
                                <div class="item-preview">
                                    <img src="/images/items/perfume.png" alt="Perfume Bottle">
                                </div>
                            </div>
                            <button class="btn btn-primary open-case-btn" data-case="bayrex">Открыть за 150 ★</button>
                        </div>
                    </div>
                </div>
                
                <h2 class="inventory-title">Ваши подарки</h2>
                <div class="inventory-container" id="inventory"></div>
            </div>
            
            <div class="tab-content" id="leaders-tab">
                <h2 class="section-title">Таблица лидеров</h2>
                <table class="leaders-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Игрок</th>
                            <th>Баланс</th>
                            <th>Открыто кейсов</th>
                            <th>Лучший предмет</th>
                        </tr>
                    </thead>
                    <tbody id="leaders-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Модальное окно регистрации -->
    <div class="modal" id="registration-modal">
        <div class="modal-content">
            <button class="modal-close" id="close-registration">&times;</button>
            <h2 class="modal-title">Регистрация</h2>
            <form id="registration-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" required>
                </div>
                <div class="form-group">
                    <label for="username">Имя пользователя</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Пароль</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <div class="captcha-container">
                    <div class="captcha-code" id="captcha-code">A1B2C3</div>
                    <input type="text" class="form-control captcha-input" id="captcha-input" placeholder="Введите капчу" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" id="cancel-registration">Отмена</button>
                    <button type="submit" class="btn btn-primary">Зарегистрироваться</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Модальное окно рулетки -->
    <div class="modal" id="roulette-modal">
        <div class="modal-content roulette-modal">
            <button class="modal-close" id="close-roulette">&times;</button>
            <h2 class="modal-title" id="roulette-case-name">Открытие кейса</h2>
            
            <div class="roulette-container">
                <div class="roulette-wheel" id="roulette-wheel">
                    <!-- Рулетка будет генерироваться динамически -->
                </div>
                <div class="roulette-pointer"></div>
            </div>
            
            <div class="possible-items">
                <h3>Возможные предметы:</h3>
                <div class="items-grid" id="possible-items">
                    <!-- Предметы будут добавляться динамически -->
                </div>
            </div>
            
            <div class="roulette-controls">
                <button class="btn btn-secondary" id="close-roulette-btn">Отмена</button>
                <button class="btn btn-primary" id="spin-roulette">Открыть кейс</button>
            </div>
        </div>
    </div>

    <!-- Анимация открытия кейса -->
    <div class="case-opening" id="case-opening">
        <div class="case-reward">
            <div class="reward-image" id="reward-image">
                <img src="" alt="Reward" id="reward-image-img" style="display:none">
                <span id="reward-emoji">🎁</span>
            </div>
            <div class="reward-name" id="reward-name">Mighty Arm</div>
            <div class="reward-value" id="reward-value">Цена: 10 ★</div>
            <button class="btn btn-primary" id="close-case">Закрыть</button>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin + '/api';
        let user = null;
        let token = localStorage.getItem('telegramGiftsToken');
        let casesData = null;
        let currentCaseData = null;
        let isSpinning = false;

        // DOM Elements
        const elements = {
            balance: document.getElementById('balance'),
            userAvatar: document.getElementById('user-avatar'),
            dropdownMenu: document.getElementById('dropdown-menu'),
            registrationModal: document.getElementById('registration-modal'),
            registrationForm: document.getElementById('registration-form'),
            inventoryContainer: document.getElementById('inventory'),
            adminPanel: document.getElementById('admin-panel'),
            leadersBody: document.getElementById('leaders-body'),
            tabs: document.querySelectorAll('.tab'),
            tabContents: document.querySelectorAll('.tab-content')
        };

        // Улучшенная функция API вызовов с повторными попытками
        async function apiCallWithRetry(endpoint, method = 'GET', data = null, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    return await apiCall(endpoint, method, data);
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
                }
            }
        }

        // Основная функция API вызовов
        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };

            if (token) {
                options.headers['Authorization'] = `Bearer ${token}`;
            }

            if (data) {
                options.body = JSON.stringify(data);
            }

            const response = await fetch(`${API_BASE}${endpoint}`, options);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            return result;
        }

        // Функция для показа уведомлений
        function showNotification(message, type = 'info') {
            // Создаем элемент уведомления
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span>${message}</span>
                    <button class="notification-close">&times;</button>
                </div>
            `;
            
            // Стили для уведомления
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 400px;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            // Автоматическое скрытие
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
            
            // Закрытие по клику
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            });
        }

        // Инициализация приложения
        async function initApp() {
            try {
                showNotification('Загрузка приложения...', 'info');
                
                // Сначала загружаем кейсы
                await loadCases();
                
                if (token) {
                    user = await apiCallWithRetry('/user');
                    updateUI();
                    await loadLeaders();
                    showNotification('Добро пожаловать обратно!', 'success');
                } else {
                    showRegistrationModal();
                }
            } catch (error) {
                console.error('Ошибка инициализации:', error);
                showNotification('Ошибка загрузки приложения', 'error');
                localStorage.removeItem('telegramGiftsToken');
                showRegistrationModal();
            }
        }

        function showRegistrationModal() {
            elements.registrationModal.classList.add('active');
            generateCaptcha();
        }

        async function generateCaptcha() {
            try {
                const data = await apiCallWithRetry('/captcha');
                document.getElementById('captcha-code').textContent = data.captcha;
            } catch (error) {
                console.error('Ошибка загрузки капчи:', error);
                // Генерируем капчу локально если сервер не отвечает
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let captcha = '';
                for (let i = 0; i < 6; i++) {
                    captcha += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                document.getElementById('captcha-code').textContent = captcha;
            }
        }

        async function registerUser(email, username, password, captchaInput) {
            const captcha = document.getElementById('captcha-code').textContent;
            const result = await apiCallWithRetry('/register', 'POST', {
                email, username, password, captchaInput, captcha
            });

            token = result.token;
            user = result.user;
            localStorage.setItem('telegramGiftsToken', token);
            updateUI();
            loadLeaders();
            elements.registrationModal.classList.remove('active');
            return result;
        }

        async function loadCases() {
            try {
                console.log('Загрузка кейсов...');
                casesData = await apiCallWithRetry('/cases');
                console.log('Кейсы загружены:', casesData);
            } catch (error) {
                console.error('Ошибка загрузки кейсов:', error);
                showNotification('Не удалось загрузить кейсы', 'error');
                // Создаем данные по умолчанию
                casesData = {
                    daily: {
                        name: "Ежедневный кейс",
                        price: 0,
                        items: [
                            { id: 1, name: "Mighty Arm", image: "/images/items/mighty-arm.png", value: 10 },
                            { id: 2, name: "Desk Calendar", image: "/images/items/desk-calendar.png", value: 15 },
                            { id: 3, name: "Flying Broom", image: "/images/items/flying-broom.png", value: 20 }
                        ]
                    },
                    bomj: {
                        name: "Бомжик",
                        price: 0,
                        items: [
                            { id: 4, name: "Сердечко", image: "/images/items/heart.png", value: 5 },
                            { id: 5, name: "Мишка", image: "/images/items/bear.png", value: 8 },
                            { id: 6, name: "Роза", image: "/images/items/rose.png", value: 12 }
                        ]
                    }
                };
            }
        }

        async function loadLeaders() {
            try {
                const leaders = await apiCallWithRetry('/leaders');
                renderLeaders(leaders);
            } catch (error) {
                console.error('Ошибка загрузки лидеров:', error);
            }
        }

        // Функции для рулетки
        function openRouletteModal(caseType) {
            if (!casesData) {
                showNotification('Данные кейсов не загружены', 'error');
                return;
            }
            
            currentCaseData = casesData[caseType];
            if (!currentCaseData) {
                showNotification('Кейс не найден', 'error');
                return;
            }
            
            // Проверяем баланс для платных кейсов
            if (currentCaseData.price > 0 && user.balance < currentCaseData.price) {
                showNotification('Недостаточно звезд для открытия этого кейса!', 'error');
                return;
            }
            
            // Заполняем модальное окно
            document.getElementById('roulette-case-name').textContent = `Открытие: ${currentCaseData.name}`;
            
            // Создаем рулетку
            createRouletteWheel(currentCaseData.items);
            
            // Показываем возможные предметы
            showPossibleItems(currentCaseData.items);
            
            // Показываем модальное окно
            document.getElementById('roulette-modal').classList.add('active');
        }

        function createRouletteWheel(items) {
            const wheel = document.getElementById('roulette-wheel');
            wheel.innerHTML = '';
            wheel.style.transform = 'rotate(0deg)';
            
            const anglePerItem = 360 / items.length;
            
            items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'roulette-item';
                itemElement.style.transform = `rotate(${index * anglePerItem}deg)`;
                
                // Чередуем цвета для лучшей видимости
                const hue = (index * 360 / items.length) % 360;
                itemElement.style.background = `hsl(${hue}, 70%, 45%)`;
                
                itemElement.innerHTML = `
                    <div class="roulette-item-content">
                        <img src="${item.image}" alt="${item.name}" class="roulette-item-image">
                        <div class="roulette-item-name">${item.name}</div>
                    </div>
                `;
                
                wheel.appendChild(itemElement);
            });
        }

        function showPossibleItems(items) {
            const container = document.getElementById('possible-items');
            container.innerHTML = '';
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item-preview-card';
                itemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="item-preview-image">
                    <div class="item-preview-name">${item.name}</div>
                    <div class="item-preview-value">${item.value} ★</div>
                `;
                container.appendChild(itemElement);
            });
        }

        async function spinRoulette() {
            if (isSpinning || !currentCaseData) return;
            
            isSpinning = true;
            const spinButton = document.getElementById('spin-roulette');
            spinButton.disabled = true;
            spinButton.textContent = 'Открываем...';
            
            try {
                // Выбираем случайный предмет
                const randomIndex = Math.floor(Math.random() * currentCaseData.items.length);
                const winningItem = currentCaseData.items[randomIndex];
                
                // Рассчитываем угол остановки (ставим выигрышный предмет сверху)
                const anglePerItem = 360 / currentCaseData.items.length;
                const stopAngle = 360 - (randomIndex * anglePerItem) + anglePerItem / 2;
                
                // Запускаем анимацию
                const wheel = document.getElementById('roulette-wheel');
                wheel.style.setProperty('--stop-angle', `${stopAngle}deg`);
                wheel.classList.add('spinning');
                
                // Ждем окончания анимации
                await new Promise(resolve => setTimeout(resolve, 4000));
                
                // Открываем кейс на сервере
                const result = await apiCallWithRetry('/open-case', 'POST', { 
                    caseType: Object.keys(casesData).find(key => casesData[key] === currentCaseData)
                });
                
                // Обновляем данные пользователя
                user.balance = result.newBalance;
                user.casesOpened = result.casesOpened;
                user.inventory.push(result.reward);
                
                // Показываем результат
                showRewardAnimation(result.reward);
                
                // Закрываем модальное окно
                closeRouletteModal();
                
                // Обновляем UI
                updateUI();
                loadLeaders();
                
            } catch (error) {
                showNotification(error.message, 'error');
                // Сбрасываем анимацию при ошибке
                const wheel = document.getElementById('roulette-wheel');
                wheel.classList.remove('spinning');
                wheel.style.transform = 'rotate(0deg)';
            } finally {
                isSpinning = false;
                spinButton.disabled = false;
                spinButton.textContent = 'Открыть кейс';
            }
        }

        function closeRouletteModal() {
            document.getElementById('roulette-modal').classList.remove('active');
            const wheel = document.getElementById('roulette-wheel');
            wheel.classList.remove('spinning');
            wheel.style.transform = 'rotate(0deg)';
            currentCaseData = null;
        }

        function showRewardAnimation(reward) {
            const rewardImage = document.getElementById('reward-image');
            const rewardImageImg = document.getElementById('reward-image-img');
            const rewardEmoji = document.getElementById('reward-emoji');
            
            // Показываем изображение
            if (reward.image) {
                rewardImageImg.src = reward.image;
                rewardImageImg.style.display = 'block';
                rewardEmoji.style.display = 'none';
            } else {
                rewardEmoji.style.display = 'block';
                rewardImageImg.style.display = 'none';
            }
            
            document.getElementById('reward-name').textContent = reward.name;
            document.getElementById('reward-value').textContent = `Цена: ${reward.value} ★`;
            document.getElementById('case-opening').classList.add('active');
        }

        // Функция для проверки достижений
        async function checkAchievements() {
            try {
                const result = await apiCallWithRetry('/achievements');
                if (result.unlocked && result.unlocked.length > 0) {
                    result.unlocked.forEach(achievement => {
                        showNotification(
                            `Достижение разблокировано: ${achievement.name}! +${achievement.reward} ★`,
                            'success'
                        );
                    });
                    // Обновляем баланс если получили награду
                    if (result.unlocked.length > 0) {
                        user = await apiCallWithRetry('/user');
                        updateUI();
                    }
                }
                return result;
            } catch (error) {
                console.error('Ошибка проверки достижений:', error);
            }
        }

        // Функция для проверки ежедневного бонуса
        async function checkDailyBonus() {
            try {
                const result = await apiCallWithRetry('/daily-bonus', 'POST');
                user.balance = result.newBalance;
                updateUI();
                loadLeaders();
                showNotification(result.message, 'success');
            } catch (error) {
                if (error.message.includes('уже получали')) {
                    showNotification('Вы уже получали бонус сегодня', 'info');
                } else {
                    showNotification(error.message, 'error');
                }
            }
        }

        async function sellItem(itemId) {
            try {
                const result = await apiCallWithRetry('/sell-item', 'POST', { itemId });
                user.balance = result.newBalance;
                user.inventory = user.inventory.filter(item => item.id !== itemId);
                updateUI();
                loadLeaders();
                showNotification(`Предмет продан за ${result.soldItem.value} ★`, 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function changeAvatar(avatarUrl) {
            try {
                await apiCallWithRetry('/change-avatar', 'POST', { avatarUrl });
                user.avatar = avatarUrl;
                updateUI();
                showNotification('Аватар успешно изменен', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function activatePromoCode(promoCode) {
            try {
                const result = await apiCallWithRetry('/activate-promo', 'POST', { promoCode });
                user.balance = result.newBalance;
                updateUI();
                loadLeaders();
                showNotification(result.message, 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function setUserBalance(targetUsername, newBalance) {
            try {
                const result = await apiCallWithRetry('/admin/set-balance', 'POST', { targetUsername, newBalance });
                if (targetUsername === user.username) {
                    user.balance = parseInt(newBalance);
                    updateUI();
                }
                loadLeaders();
                showNotification(result.message, 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        function updateUI() {
            if (!user) return;
            
            elements.balance.textContent = user.balance;
            
            if (user.avatar) {
                elements.userAvatar.innerHTML = `<img src="${user.avatar}" alt="Avatar">`;
            } else {
                elements.userAvatar.innerHTML = `<span>${user.username.charAt(0).toUpperCase()}</span>`;
            }
            
            if (user.isAdmin) {
                elements.adminPanel.classList.add('active');
            }
            
            renderInventory();
        }

        function renderInventory() {
            elements.inventoryContainer.innerHTML = '';
            
            if (!user.inventory || user.inventory.length === 0) {
                elements.inventoryContainer.innerHTML = 
                    '<p style="grid-column: 1 / -1; text-align: center; padding: 20px; color: rgba(255,255,255,0.5);">У вас пока нет подарков. Откройте кейсы, чтобы получить подарки!</p>';
                return;
            }
            
            user.inventory.forEach((item) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'inventory-item';
                itemElement.innerHTML = `
                    <div class="item-image">
                        <img src="${item.image}" alt="${item.name}">
                    </div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-value">${item.value} ★</div>
                    <button class="sell-btn" data-id="${item.id}">Продать за ${item.value} ★</button>
                `;
                elements.inventoryContainer.appendChild(itemElement);
            });
            
            document.querySelectorAll('.sell-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-id');
                    sellItem(itemId);
                });
            });
        }

        function renderLeaders(leaders) {
            elements.leadersBody.innerHTML = '';
            
            leaders.forEach((leader, index) => {
                const row = document.createElement('tr');
                const isCurrentUser = user && leader.username === user.username;
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        <div class="leader-user">
                            <div class="leader-avatar">${leader.username.charAt(0).toUpperCase()}</div>
                            ${leader.username} ${isCurrentUser ? '<strong>(Вы)</strong>' : ''}
                        </div>
                    </td>
                    <td>${leader.balance} ★</td>
                    <td>${leader.casesOpened}</td>
                    <td>${leader.bestItem}</td>
                `;
                
                if (isCurrentUser) {
                    row.style.backgroundColor = 'rgba(51, 144, 236, 0.1)';
                }
                
                elements.leadersBody.appendChild(row);
            });
        }

        // Event Listeners
        document.getElementById('registration-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const captchaInput = document.getElementById('captcha-input').value;
            
            try {
                await registerUser(email, username, password, captchaInput);
                showNotification('Регистрация успешна!', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
                generateCaptcha();
            }
        });

        // Обработчики для кейсов (открытие рулетки)
        document.querySelectorAll('.open-case-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const caseType = this.getAttribute('data-case');
                openRouletteModal(caseType);
            });
        });

        // Обработчики для модального окна рулетки
        document.getElementById('close-roulette').addEventListener('click', closeRouletteModal);
        document.getElementById('close-roulette-btn').addEventListener('click', closeRouletteModal);
        document.getElementById('spin-roulette').addEventListener('click', spinRoulette);

        // Закрытие по клику вне модального окна
        document.getElementById('roulette-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeRouletteModal();
            }
        });

        document.getElementById('change-avatar').addEventListener('click', function() {
            const avatarUrl = prompt('Введите URL вашего аватара:');
            if (avatarUrl) changeAvatar(avatarUrl);
        });

        document.getElementById('promo-code').addEventListener('click', function() {
            const promoCode = prompt('Введите промокод:');
            if (promoCode) activatePromoCode(promoCode);
        });

        document.getElementById('daily-bonus').addEventListener('click', checkDailyBonus);

        document.getElementById('set-balance-btn').addEventListener('click', function() {
            const targetUsername = document.getElementById('username-input').value;
            const newBalance = document.getElementById('balance-input').value;
            if (targetUsername && newBalance) {
                setUserBalance(targetUsername, newBalance);
            } else {
                showNotification('Заполните все поля', 'error');
            }
        });

        document.getElementById('best-drop').addEventListener('click', function() {
            if (!user.inventory.length) {
                showNotification('У вас пока нет подарков!', 'error');
                return;
            }
            const bestItem = user.inventory.reduce((best, current) => 
                current.value > best.value ? current : best, user.inventory[0]);
            showNotification(`Ваш лучший подарок: ${bestItem.name} стоимостью ${bestItem.value} ★`, 'info');
        });

        document.getElementById('statistics').addEventListener('click', function() {
            const totalValue = user.inventory.reduce((sum, item) => sum + item.value, 0);
            const stats = `Статистика:
Открыто кейсов: ${user.casesOpened}
Количество подарков: ${user.inventory.length}
Общая стоимость: ${totalValue} ★`;
            alert(stats);
        });

        document.getElementById('close-registration').addEventListener('click', () => {
            elements.registrationModal.classList.remove('active');
        });

        document.getElementById('cancel-registration').addEventListener('click', () => {
            elements.registrationModal.classList.remove('active');
        });

        document.getElementById('close-case').addEventListener('click', () => {
            document.getElementById('case-opening').classList.remove('active');
        });

        elements.userAvatar.addEventListener('click', () => {
            elements.dropdownMenu.classList.toggle('active');
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-profile')) {
                elements.dropdownMenu.classList.remove('active');
            }
        });

        elements.tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                elements.tabs.forEach(t => t.classList.remove('active'));
                elements.tabContents.forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });

        document.getElementById('refresh-btn').addEventListener('click', () => {
            location.reload();
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
